<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ month_name }} {{ year }} Calendar</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: rgba(93, 215, 175, 0.1);
      background-image: url("{{ url_for('static', filename='flower.jpg') }}");
      background-blend-mode: soft-light;
      background-size: cover;
      text-align: center;
      padding: 0;
      margin: 0;
    }

    h1 {
      margin-top: 20px;
      font-size: 2em;
      color: #1b4332;
    }

    .nav {
      margin: 20px 0;
      display: flex;
      justify-content: center;
      gap: 15px;
    }

    .nav a {
      text-decoration: none;
      color: white;
      background-color: #2a9d8f;
      padding: 10px 20px;
      border-radius: 8px;
      transition: 0.3s;
    }

    .nav a:hover {
      background-color: #21867a;
      transform: translateY(-2px);
    }

    table {
      border-collapse: collapse;
      width: 90%;
      max-width: 800px;
      margin: 0 auto 30px auto;
      background-color: rgba(255,255,255,0.9);
      border-radius: 10px;
      overflow: hidden;
    }

    th, td {
      border: 1px solid #2a9d8f;
      padding: 15px;
      text-align: center;
      min-width: 40px;
      position: relative;
    }

    th {
      background-color: #2a9d8f;
      color: white;
    }

    td.empty {
      background-color: #f0f0f0;
    }

    td.today {
      background-color: #e9c46a;
      font-weight: bold;
      color: #264653;
      transition: 0.5s;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    #notepad {
      width: 90%;
      max-width: 700px;     /* reduced max-width */
      margin: 20px auto 50px auto;
      padding: 20px;
      border-radius: 10px;
      background-color: rgba(255,255,255,0.95);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      box-sizing: border-box;   /* ensures padding is included in width */
    }

    #notepad textarea {
      width: 100%;
      height: 150px;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #2a9d8f;
      font-size: 16px;
      resize: vertical;
      box-sizing: border-box;   /* ensures padding doesnâ€™t overflow */
    }

    #notepad button {
      margin-top: 10px;
      padding: 10px 20px;
      background-color: #2a9d8f;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
    }

    #notepad button:hover {
      background-color: #21867a;
      transform: translateY(-2px);
    }

    @media screen and (max-width: 500px) {
      #notepad {
        width: 95%;   /* smaller width on mobile */
        padding: 15px;
      }

      #notepad textarea {
        height: 120px;
      }
    }
  </style>
</head>
<body>
  <h1>{{ month_name }} {{ year }}</h1>
  <div class="nav">
    <a href="{{ url_for('index') }}">Home</a>
    <a href="{{ url_for('show_calendar', month=month-1 if month>1 else 12, year=year if month>1 else year-1) }}">Previous</a>
    <a href="{{ url_for('show_calendar', month=month+1 if month<12 else 1, year=year if month<12 else year+1) }}">Next</a>
  </div>

  <table>
    <thead>
      <tr>
        <th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th>
        <th>Thu</th><th>Fri</th><th>Sat</th>
      </tr>
    </thead>
    <tbody>
      {% set today_date = datetime.today().day if datetime.today().month==month and datetime.today().year==year else 0 %}
      {% for week in month_days %}
      <tr>
        {% for day in week %}
          {% if day == 0 %}
            <td class="empty"></td>
          {% elif day == today_date %}
            <td class="today" data-day="{{ day }}">{{ day }}</td>
          {% else %}
            <td data-day="{{ day }}">{{ day }}</td>
          {% endif %}
        {% endfor %}
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div id="notepad">
    <h3>Notes for <span id="selected-date">Today</span></h3>
    <textarea id="notes" placeholder="Write your notes here..."></textarea>
    <br>
    <button onclick="saveNotes()">Save Notes</button>
  </div>

  <script>
    const notesArea = document.getElementById('notes');
    const selectedDateSpan = document.getElementById('selected-date');
    const todayCell = document.querySelector('.today') || document.querySelector('td[data-day]');

    let selectedDay = todayCell.dataset.day;
    selectedDateSpan.textContent = `{{ month_name }} ${selectedDay}, {{ year }}`;

    function loadNotes() {
      const key = `note_{{ year }}_{{ month }}_${selectedDay}`;
      notesArea.value = localStorage.getItem(key) || '';
    }

    function saveNotes() {
      const key = `note_{{ year }}_{{ month }}_${selectedDay}`;
      localStorage.setItem(key, notesArea.value);
      alert("Note saved!");
    }

    // Load initial note
    loadNotes();

    // Click on any day to switch note
    document.querySelectorAll('td[data-day]').forEach(td => {
      td.addEventListener('click', () => {
        selectedDay = td.dataset.day;
        selectedDateSpan.textContent = `{{ month_name }} ${selectedDay}, {{ year }}`;
        loadNotes();
      });
    });
  </script>
</body>
</html>
